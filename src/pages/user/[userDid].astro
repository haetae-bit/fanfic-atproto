---
import { db, eq, Users, Works } from "astro:db";

const { userDid } = Astro.params;

const user = await db.select()
  .from(Users)
  .where(eq(Users.userDid, userDid!))
  .innerJoin(Works, eq(Works.author, Users.userDid))
  .limit(1);

if (user.length === 0) {
  return Astro.redirect("/not-found");
}
---

{user.map(({ Users, Works }) => (
  <>
    <h1>{Users.userDid}</h1>
    {JSON.stringify(Works)}
  </>
))}